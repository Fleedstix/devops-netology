# Домашнее задание к занятию "11.03 Микросервисы: подходы"

> 1. Вы работаете в крупной компанию, которая строит систему на основе микросервисной архитектуры. Вам как DevOps специалисту необходимо выдвинуть предложение по организации инфраструктуры, для разработки и эксплуатации.


> Предложите решение для обеспечения процесса разработки: хранение исходного кода, непрерывная интеграция и непрерывная поставка. 
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.
Решение должно соответствовать следующим требованиям:
> - Облачная система;
> - Система контроля версий Git;
> - Репозиторий на каждый сервис;
> - Запуск сборки по событию из системы контроля версий;
> - Запуск сборки по кнопке с указанием параметров;
> - Возможность привязать настройки к каждой сборке;
> - Возможность создания шаблонов для различных конфигураций сборок;
> - Возможность безопасного хранения секретных данных: пароли, ключи доступа;
> - Несколько конфигураций для сборки из одного репозитория;
> - Кастомные шаги при сборке;
> - Собственные докер образы для сборки проектов;
> - Возможность развернуть агентов сборки на собственных серверах;
> - Возможность параллельного запуска нескольких сборок;
> - Возможность параллельного запуска тестов;
> Обоснуйте свой выбор. 

По моему мнению, для решения поставленной задачи больше всего подходит GitLab, он удовлетворяет большей части требований, т.к. является комбайном жизненного цикла DevOps. Но также, можно рассмотреть вариант с использованием инструментов, которые решают узкую задачу, Например: 

* Hashicorp Vault
* Harbor
* Nexus
* Artifactory
* Jenkins
* Bitbucket


> 2. Предложите решение для обеспечения сбора и анализа состояния хостов и сервисов в микросервисной архитектуре. Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия. Решение должно соответствовать следующим требованиям:
>
> Решение должно соответствовать следующим требованиям:
> 
>* Сбор метрик со всех хостов, обслуживающих систему;
>* Сбор метрик состояния ресурсов хостов: CPU, RAM, HDD, Network;
>* Сбор метрик потребляемых ресурсов для каждого сервиса: CPU, RAM, HDD, Network;
>* Сбор метрик, специфичных для каждого сервиса;
>* Пользовательский интерфейс с возможностью делать запросы и агрегировать информацию;
>* Пользовательский интерфейс с возможность настраивать различные панели для отслеживания состояния системы;
>
> Обоснуйте свой выбор.

для обеспечения сбора и анализа состояния хостов и сервисов в микросервисной архитектуре я бы рекомендовал ELK стэк, а также как альтернативу можно рассмотреть Graylog или Grafana Loki.

Плюсы Graylog:

Cамое важное отличие и достоинство Graylog Open перед ELK-стеком - наличие встроенной системы оповещений (алертов) при возникновении каких-либо специфических ситуации или событий в процессе сбора логов (в ELK система оповещений есть, но она - платная, хотя есть и бесплатные сторонние плагины с подобным функционалом). 

Плюсы Grafana Loki:

лёгко устанавливается, потребляет мало ресурсов, не требует установки Elasticsearch, так как хранит данные в TSDB (time series database).TSDB отлично справляется с задачей хранения большого количества данных, временных рядов, но не предназначена для долгого хранения. Если по какой-то причине вам нужно хранить логи дольше двух недель, то лучше настроить их передачу в другую БД.


> 3. Предложите решение для обеспечения сбора и анализа состояния хостов и сервисов в микросервисной архитектуре. Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия. Решение должно соответствовать следующим требованиям:
> * Сбор метрик со всех хостов, обслуживающих систему;
> * Сбор метрик состояния ресурсов хостов: CPU, RAM, HDD, Network;
> * Сбор метрик потребляемых ресурсов для каждого сервиса: CPU, RAM, HDD, Network;
> * Сбор метрик, специфичных для каждого сервиса;
> * Пользовательский интерфейс с возможностью делать запросы и агрегировать информацию;
> * Пользовательский интерфейс с возможность настраивать различные панели для отслеживания состояния системы;
> Обоснуйте свой выбор.

Для сбора метрик, я бы предложил Prometheus, для хранения VictoriaMetrix, для визуализации - Grafana. И Prometheus, и VictoriaMetrics могут собирать миллионы метрик с тысяч целевых объектов на машине с парой ядер vCPU. Это гораздо лучший результат, чем InfluxDB и TimescaleDB.
VictoriaMetrics требует до 5 раз меньше оперативной памяти и до 7 раз меньше дискового пространства по сравнению с Prometheus при скрайпинге тысяч node_exporter. Это приводит к значительной экономии на инфраструктуре.